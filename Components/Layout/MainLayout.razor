@inherits LayoutComponentBase
@inject IThemeService ThemeService
@using JournalManagementSystem.Services
@implements IAsyncDisposable

<div class="page" data-theme="@ThemeService.CurrentTheme.ToString().ToLower()">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="theme-toolbar">
            <div class="theme-selector-container">
                <label for="theme-select" class="theme-label">Theme:</label>
                <select id="theme-select" class="theme-select" @onchange="OnThemeChanged">
                    @foreach (var theme in ThemeService.GetAvailableThemes())
                    {
                        <option value="@theme" selected="@(theme == ThemeService.CurrentTheme)">
                            @GetThemeDisplayName(theme)
                        </option>
                    }
                </select>
            </div>
        </div>
        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await ThemeService.InitializeAsync();
    }

    private async Task OnThemeChanged(ChangeEventArgs e)
    {
        if (Enum.TryParse<AppTheme>(e.Value?.ToString(), out var theme))
        {
            await ThemeService.SetThemeAsync(theme);
            StateHasChanged();
        }
    }

    private string GetThemeDisplayName(AppTheme theme) => theme switch
    {
        AppTheme.Light => "Light",
        AppTheme.Dark => "Dark",
        _ => theme.ToString()
    };

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        await ValueTask.CompletedTask;
    }
}